## Synchronization
>> 실행의 문맥을 갖는 모든 대상은 동기화 대상 -> 스레드도 동기화 대상임
>> 편의상 '프로세스'만 지칭할 뿐
- 공동의 목적을 위해 동시에 수행되는 프로세스
  - e.g. 워드 프로세서
    - 맞춤법 검사 프로세스
    - 입력 내용 화면에 출력하는 프로세스 ...
  - 올바른 수행을 위해 동기화 되어야 함 -> 자원의 일관성 보장 필요
- 동기화: 프로세스들의 수행 시기를 맞추는 것
  - **실행 순서 제어**: 프로세서를 올바른 순서대로 실행
  - **상호 배제**: 동시에 접근해서 안되는 자원에 하나의 프로세스만 접근

### 실행 순서 제어를 위한 동기화
- reader writer problem
> writer: book.txt에 값을 저장하는 프로세스<br/>
> reader: book.txt에 값을 읽어들이는 프로세스
- reader는 book.txt에 값이 존재한다는 *특정 조건*이 만족되어야만 실행 가능

### 상호 배제를 위한 동기화
- bank account problem
  - 공유 불가능한 자원의 동시 사용을 피하기 위한 동기화
    > 현재 계좌 10만원<br/>
    > 프로세스 A: 현재 잔액에 2만원을 추가<br/>
    > 프로세스 B: 현재 잔액에 5만원 추가

- producer & consumer problem
    > 물건을 계속해서 생산하는 producer<br/>
    > 물건을 계속해서 소비하는 consumer<br/>
    > '총합' 변수 공유
- 공유자원: 여러 프로세스 혹은 스레드가 공유하는 자원
  - 전역 변수, 파일, 입출력장치, 보조기억장치, ...
- 임계구역: 동시에 실행하면 문제가 발생하는 자원에 접근하는 코드 영역
- race condition: 임계 구역에 동시에 접근하면 자원의 일관성이 깨질 수 있다
- 상호 배제를 위한 동기화를 위한 세 가지 원칙
  - 상호 배제
    - 한 프로세스가 임계 구역에 진입했다면 다른 프로세스는 들어올 수 없다
  - 진행
    - 임계 구역이 어떤 프로세스도 진입하지 않았다면 진행하고자 하는 프로세스는 들어갈 수 있어야 한다
  - 유한 대기
    - 한 프로세스가 임계구역에 진입하고 싶다면 언젠가는 임게 구역에 들어올 수 있어야 한다 (무한 대기해서는 안된다)
  
### 동기화 기법
- 뮤택스 락
  - 자물쇠 역할: 프로세스들이 공유하는 전역 변수 lock
  - 임계 구역 잠그는 역할: acquire 함수 -> busy waiting (잠김 여부를 반복적으로 확인)
  - 임계 구역 잠금 해제 역할: release 함수
  ```C++
  acquire(){
    while(lock == true) // busy waiting
        ;
    lock = true;
  }

  release(){
    lock = false;
  }

  acquire(); // 자물쇠 잠금 여부 확인 && 잠겨있지 않다면 잠근다
  // 임계 구역
  release(); // 자물쇠 반환
  ```
- 세마포
  - 이진 세마포, **카운팅 세마포**
  - 공유 자원이 여러 개 있는 경우에도 가능
  - 임계 구역 앞에서 멈춤 신호를 받으면 잠시 기다리기
  - 임계 구역 앞에서 가도 좋다는 신호를 받으면 임계 구역 진입
  > - 전역변수 하나<br/>
  > - 함수 두개<br/>
  >> 임계 구역에 진입할 수 있는 프로세스 개수를 나타내는 전역변수 S<br/>
  >> 임계 구역에 들어가도 좋은지 기다리는 wait 함수<br/>
  >> 임계 구역 앞에서 기다리는 프로세스에 가도 좋다는 신호 주는 signal 함수
  ```C++
  wait(){
    while (S <= 0)
        ;
    S--;
  }

  signal() {
    S++
  }
  ```
  - 세마포의 변수 S를 0으로 두고
  - 먼저 실행할 프로세스 뒤에 signal()
  - 다음에 실행할 프로세스 앞에 wait()
- 모니터
  - 매번 임계구역 앞 뒤로 wait(), signal() 호출 -> 실수 가능성이 높음
  - 상호 배제를 위한 동기화
    - 인터페이스를 위한 큐
    - 공유 자원에 접근하고자 하는 프로세스를 인터페이스를 위한 큐에 삽입
    - 큐에 삽입된 순서대로 한번에 하나의 프로세스만 공유 자원 이용
    ![Alt text](monitor.png)
  - 실행 순서 제어를 위한 동기화
    - 조건 변수를 이용
      - 프로세스나 스레드의 실행 순서를 제어하기 위해 사용되는 특별한 변수
    - 조건 변수에 대한 큐 (상호배제를 위한 큐와 다름)
    ![Alt text](signal_process.png)
    